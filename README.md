# 60-69

# 60. 認証と認可の違い
「認証（Authentication）」と「認可（Authorization）」の違い，およびWebサービスでどのように使い分けるかを調査し，200字程度でまとめよ．

---

「認証（Authentication）」とは、「あなたは誰ですか？」とユーザが本人であることを識別・検証するプロセスである。
IDやメールアドレスの確認、パスワードの確認、顔指紋認証といった、ユーザの特徴・持っていること・知っていることについての確認を行う。

「認可（Authorization）」とは、「（認証された）あなたは何ができますか？」と、認証されたユーザに権限があるかを確認して、アクセスできるリソースや操作範囲を決定するプロセスである。
例として管理者メニューへのアクセス許可などがある。

認証が通った後、認可によって利用範囲が決まるため、webサービスでは認証→認可の順で実施される。

---

# 61. セッションとクッキーの仕組み
セッションとクッキーの違い，Webサービスでの役割・仕組みを調査し，分かりやすく整理せよ．

---

HTTPはステートレスな(状態を保持しない)プロトコルであり、そのままでは同一ユーザの1つ目のリクエストから2つ目のリクエストへ情報を引き継げないため、セッションという仕組みを使って同一ブラウザからの一連のリクエスト間で「状態」を共有する。
そのセッションIDを管理する方法の1つとして挙げられるのがクッキー。

クッキーは、サーバがユーザのブラウザに小さなデータ(重要性は低め)を保存させる仕組みで、そのデータはユーザのブラウザ(クライアント側)に保存される。
ここでいう小さいデータとはユーザID、ログイン状態を示すトークン、言語設定、テーマ設定、トラッキング用ID（広告など）などである。
クッキーの保存期間は、期限設定（永続的）またはブラウザ終了時（セッションクッキー）である。

一方で、セッションは、サーバ側でユーザの属性や状態(より機密性の高い情報)を一時的に管理する仕組みであり、サーバ側のメモリやデータベースに保存される。
具体的には、ログイン中かどうか、ログインユーザのID、カートの中身、一時的な操作状態を管理する(セッション管理)。
セッションの保存期間はブラウザを閉じたり、一定時間（タイムアウト）で終了する。

セッション自体はサーバにあるが、「どのセッションか」を識別するための セッションID が必要で、そのセッションIDをクッキーに入れて管理する。
クッキーはブラウザに保存されるデータ入れであり、セッションはサーバに保存されるユーザの状態そのものである。クッキーにセッションIDを入れて、セッション管理を行うのがwebの標準的な手法。


項目       	 |  クッキー   | 	セッション

保存場所   	 |  ブラウザ   |	    サーバ

保存期間	     |  設定次第   |  一時的

保存できる量	 |  少ない	    |  比較的多い

改ざん耐性	   |   弱い      |     強い

主な役割	     |識別情報の保持| 状態管理


連携方法

1. ユーザーがサイトにアクセス。

2. サーバーがセッションを開始し、セッションIDを発行。

3. サーバーはセッションIDとユーザー情報をサーバー側に保存。

4. サーバーはセッションIDをクッキー（セッションクッキー）としてブラウザに送る。

5. 次回以降のアクセスでブラウザがそのセッションIDをクッキーでサーバーに送る。

6. サーバーはそのセッションIDを元にユーザー情報を特定し、ログイン状態などを復元する。

---



# 62. パスワードの安全な保存
生パスワード保存の危険性と，ハッシュ化（例：bcrypt, scrypt, pbkdf2等）の意義を調査・整理せよ．

---

生パスワード保存とは、ユーザが入力したパスワードをそのままの平文でデータベースに保存すること。
これをすると、攻撃者がDBを入手するとすべてのユーザのパスワードが即座に分かってしまい、同じパスワードを使っている別サービスにまで二次被害が発生する。
また管理者がユーザパスワードをそのまま見ることができ、プライバシー侵害が発生する。
その他にも、パスワード流出に関してSQLインジェクション、設定ミス、バックアップ流出などの自己想定ができ、その被害を最小限にする工夫が必要になる。

ハッシュ化とは、ハッシュ関数という特殊な計算方法を用いて、元のデータを不可逆的に（元に戻せないように）固定長のランダムな文字列（ハッシュ値）に変換する処理である。
ハッシュ関数の大きな特徴は、一方向性（元に戻せない）、同じ入力からは必ず同じ出力になること、少し変えると全く違う出力になることである。

似たもので暗号化があるが、暗号化がデータを復号できる「可逆的」な処理であるのに対し、ハッシュ化は「不可逆的」であることが大きな違いである。

ハッシュ化を用いてパスワードそのままではなく、ハッシュ化したハッシュ値のみ保存することで、パスワードが生のまま漏れて悪用されることを防ぐことができる。
パスワードの安全な保管やデータの改ざん検知に応用できる。

---

# 63. ユーザ登録API
ユーザ名とパスワードを受け取り，パスワードをハッシュ化してデータベースに登録するAPIを実装せよ．

index_63.jsなどは60-69フォルダにいれています

bashでの操作

<img width="734" height="395" alt="image" src="https://github.com/user-attachments/assets/eac63813-b999-4cdc-9bc7-7fea7632fea8" />


別ターミナルを開いてcurlコマンド

<img width="753" height="134" alt="image" src="https://github.com/user-attachments/assets/ff82e154-a00d-4359-a6a7-34798d508f14" />

<img width="687" height="109" alt="image" src="https://github.com/user-attachments/assets/6c1ba4ad-3958-4979-b144-557516a804f0" />


sqlite3を実行し、users.dbのデータ(id, username, password_hash(ハッシュ化したパスワード))を表示

<img width="685" height="341" alt="image" src="https://github.com/user-attachments/assets/ecbc962f-f67d-461f-891e-990014ff3c4b" />



# 64. ログインAPI
ユーザ名とパスワードでログインを受け付け，パスワードの照合（ハッシュ値の検証）を行い，結果を返すAPIを実装せよ．


# 65. セッション管理
express-session等のミドルウェアを使い，ログイン後にセッション情報を保持し，認証済みユーザのみがアクセスできるAPIエンドポイントを設けよ．


# 66. クッキーを利用したセッション管理
クッキーの仕組みを使い，セッションIDなどがクライアントに安全に保存されていることを確認せよ．
必要に応じてクッキーの属性（Secure, HttpOnly等）を調査すること．
